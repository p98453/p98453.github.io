<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>探究通过各种绕过网易易盾人工验证的方法 | 小牛壮士</title><meta name="author" content="kukudelin"><meta name="copyright" content="kukudelin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言：在网络安全与情报分析工作中，自动化抓取互联网信息成为关键手段。然而，越来越多网站为防范爬虫和批量操作，部署了多样化、高难度的人工验证机制，包括滑块拼图、汉字点选、障碍躲避等类型。这些验证码不仅包含图形干扰，还融入语义理解（如“点击包含交通标志的图片”）、逻辑判断（如“按成语顺序点选汉字”）甚至动态行为分析，使得传统的自动化绕过方法（如基于 OpenCV 的模板匹配、OCR 识别）难以应对——">
<meta property="og:type" content="article">
<meta property="og:title" content="探究通过各种绕过网易易盾人工验证的方法">
<meta property="og:url" content="http://example.com/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/index.html">
<meta property="og:site_name" content="小牛壮士">
<meta property="og:description" content="前言：在网络安全与情报分析工作中，自动化抓取互联网信息成为关键手段。然而，越来越多网站为防范爬虫和批量操作，部署了多样化、高难度的人工验证机制，包括滑块拼图、汉字点选、障碍躲避等类型。这些验证码不仅包含图形干扰，还融入语义理解（如“点击包含交通标志的图片”）、逻辑判断（如“按成语顺序点选汉字”）甚至动态行为分析，使得传统的自动化绕过方法（如基于 OpenCV 的模板匹配、OCR 识别）难以应对——">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/%E6%96%87%E7%AB%A0%E9%BB%98%E8%AE%A4%E5%B0%81%E9%9D%A2.png">
<meta property="article:published_time" content="2025-10-15T10:19:20.000Z">
<meta property="article:modified_time" content="2026-02-10T09:19:36.865Z">
<meta property="article:author" content="kukudelin">
<meta property="article:tag" content="Python基础 OpenCV NLP 大模型">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/%E6%96%87%E7%AB%A0%E9%BB%98%E8%AE%A4%E5%B0%81%E9%9D%A2.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "探究通过各种绕过网易易盾人工验证的方法",
  "url": "http://example.com/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/",
  "image": "http://example.com/img/%E6%96%87%E7%AB%A0%E9%BB%98%E8%AE%A4%E5%B0%81%E9%9D%A2.png",
  "datePublished": "2025-10-15T10:19:20.000Z",
  "dateModified": "2026-02-10T09:19:36.865Z",
  "author": [
    {
      "@type": "Person",
      "name": "kukudelin",
      "url": "http://example.com"
    }
  ]
}</script><link rel="shortcut icon" href="/img/%E5%A4%B4%E5%83%8F.png"><link rel="canonical" href="http://example.com/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '探究通过各种绕过网易易盾人工验证的方法',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/fonts/fonts.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/%E4%B8%BB%E9%A1%B5%E8%83%8C%E6%99%AF%E5%9B%BE.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">53</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/%E6%96%87%E7%AB%A0%E9%BB%98%E8%AE%A4%E5%B0%81%E9%9D%A2.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">小牛壮士</span></a><a class="nav-page-title" href="/"><span class="site-name">探究通过各种绕过网易易盾人工验证的方法</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">探究通过各种绕过网易易盾人工验证的方法</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-10-15T10:19:20.000Z" title="发表于 2025-10-15 18:19:20">2025-10-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-10T09:19:36.865Z" title="更新于 2026-02-10 17:19:36">2026-02-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9E%E4%B9%A0%E7%AC%94%E8%AE%B0/">实习笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">6.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>26分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h1><p>在网络安全与情报分析工作中，自动化抓取互联网信息成为关键手段。然而，越来越多网站为防范爬虫和批量操作，部署了多样化、高难度的人工验证机制，包括滑块拼图、汉字点选、障碍躲避等类型。这些验证码不仅包含图形干扰，还融入语义理解（如“点击包含交通标志的图片”）、逻辑判断（如“按成语顺序点选汉字”）甚至动态行为分析，使得传统的自动化绕过方法（如基于 <strong>OpenCV 的模板匹配、OCR 识别</strong>）难以应对——前者在面对旋转、变形、动态干扰时失效，后者在复杂背景或非标准字体下识别率骤降。</p>
<p>为突破这一瓶颈，本文聚焦于<strong>滑块验证（含旋转干扰）、文字点选（成语&#x2F;顺序类）与障碍躲避</strong>三类典型验证码，调研基于视觉语言大模型的智能识别与交互新方法。通过结合Playwright与多模态大模型的语义理解能力，构建了一套能理解验证任务语义、定位目标元素、模拟人类操作的自动化流程。</p>
<p>对于高度动态、行为特征强绑定（如鼠标轨迹分析）或需上下文记忆的验证形式，当前方法仍存在局限，需进一步融合行为模拟与上下文推理能力。</p>
<p><strong>一个自动化登录的demo</strong></p>
<img src="/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/res.gif" class="" title="res">

<h1 id="一、VL大模型"><a href="#一、VL大模型" class="headerlink" title="一、VL大模型"></a>一、VL大模型</h1><h2 id="1-1-定义"><a href="#1-1-定义" class="headerlink" title="1.1 定义"></a>1.1 定义</h2><p><strong>视觉-语言大模型</strong>（Vision-Language Models, VLMs）从本质上来说就是给大语言模型（LLM）加上了一双眼睛，让LLM能有感知视觉的能力，是结合视觉（图像&#x2F;视频）和语言（文本）处理能力的多模态人工智能模型，能够理解并生成与视觉内容相关的自然语言。</p>
<img src="/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/image-20251107155327166.png" class="" title="image-20251107155327166">

<h2 id="1-2-核心组件"><a href="#1-2-核心组件" class="headerlink" title="1.2 核心组件"></a>1.2 核心组件</h2><ul>
<li><strong>视觉编码器</strong>：负责提取图像特征</li>
<li><strong>语言编码器&#x2F;解码器</strong>：处理文本信息</li>
<li><strong>跨模态融合模块</strong>：实现视觉和语言特征的深度融合</li>
</ul>
<p>VL模型作为视觉模型和自然语言模型的融合，它接收图像及其相应的文本描述作为输入。 这类模型不仅能够解释视觉内容，还能生成相关的自然语言描述，实现真正的多模态交互。</p>
<h2 id="1-3-大模型理解图像的流程"><a href="#1-3-大模型理解图像的流程" class="headerlink" title="1.3 大模型理解图像的流程"></a>1.3 大模型理解图像的流程</h2><p>其实VLM的原理和LLM是一样的，都是把用户的输入通过embedding转换成tokens输入到模型进行计算</p>
<p>VL大模型之所以能理解图片，本质上是通过<strong>深度神经网络提取视觉特征</strong>，<strong>投影层实现跨模态对齐</strong>，<strong>大语言模型进行语义融合和推理</strong>的三步走策略。它不是真的”看”图片，而是通过数学向量在高维空间中建立视觉和语言的对应关系，从而实现对图像内容的理解和描述。</p>
<h3 id="1-3-1-图像预处理阶段"><a href="#1-3-1-图像预处理阶段" class="headerlink" title="1.3.1 图像预处理阶段"></a>1.3.1 图像预处理阶段</h3><p>当一张图片输入到VL大模型时，首先会经过标准化处理：</p>
<ul>
<li>调整尺寸（通常为224×224或448×448像素）</li>
<li>归一化像素值</li>
<li>分割成固定大小的图像块（patches）</li>
</ul>
<h3 id="1-3-2-特征提取阶段"><a href="#1-3-2-特征提取阶段" class="headerlink" title="1.3.2 特征提取阶段"></a>1.3.2 特征提取阶段</h3><p>视觉编码器对预处理后的图像进行深度特征提取：</p>
<ul>
<li><strong>低层特征</strong>：边缘、纹理、颜色等基础视觉信息</li>
<li><strong>中层特征</strong>：物体部件、简单形状等</li>
<li><strong>高层特征</strong>：语义信息、物体类别、场景理解等</li>
<li><strong>空间关系</strong>：通过自注意力机制捕捉图像中不同区域之间的关系</li>
</ul>
<h3 id="1-3-3-跨模态对齐阶段"><a href="#1-3-3-跨模态对齐阶段" class="headerlink" title="1.3.3 跨模态对齐阶段"></a>1.3.3 跨模态对齐阶段</h3><p>这是VL大模型理解图像的核心机制：</p>
<p><strong>特征空间对齐</strong>：</p>
<ul>
<li>视觉特征和文本特征被映射到同一个语义空间</li>
<li>例如，当看到”狗”这个词和一张狗的图片时，它们的向量表示在空间中会很接近</li>
<li>这种对齐是通过对比学习等训练方法实现的</li>
</ul>
<p><strong>语义理解融合</strong>：</p>
<ul>
<li>投影后的视觉token和文本token一起输入到大语言模型</li>
<li>LLM通过自注意力机制同时处理视觉和语言信息</li>
<li>模型能够建立”图像区域-文本描述”之间的细粒度对应关系</li>
</ul>
<h2 id="1-4-图解各个部分处理流程"><a href="#1-4-图解各个部分处理流程" class="headerlink" title="1.4 图解各个部分处理流程"></a>1.4 图解各个部分处理流程</h2><h3 id="1-4-1-图像预处理阶段"><a href="#1-4-1-图像预处理阶段" class="headerlink" title="1.4.1 图像预处理阶段"></a>1.4.1 图像预处理阶段</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    B[输入原始图像] --&gt; C[图像预处理阶段]</span><br><span class="line">    C --&gt; C1[图像尺寸标准化]</span><br><span class="line">    C1 --&gt; C2[像素值归一化]</span><br><span class="line">    C2 --&gt; C3[图像分块处理]</span><br><span class="line">    </span><br><span class="line">    classDef process fill:#2196F3,stroke:#1976D2,color:white</span><br><span class="line">    classDef detail fill:#9C27B0,stroke:#7B1FA2,color:white</span><br><span class="line">    classDef io fill:#FF5722,stroke:#E64A19,color:white</span><br><span class="line"></span><br><span class="line">    class B,C process</span><br><span class="line">    class C1,C2,C3 detail</span><br></pre></td></tr></table></figure>

<h3 id="1-4-2视觉特征提取阶段"><a href="#1-4-2视觉特征提取阶段" class="headerlink" title="1.4.2视觉特征提取阶段"></a><strong>1.4.2视觉特征提取阶段</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    D[视觉特征提取阶段] --&gt; D1[视觉编码器处理]</span><br><span class="line">    D1 --&gt; D2[多层特征提取]</span><br><span class="line">    D2 --&gt; D21[低层特征提取]</span><br><span class="line">    D2 --&gt; D22[中层特征提取]</span><br><span class="line">    D2 --&gt; D23[高层特征提取]</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    classDef process fill:#2196F3,stroke:#1976D2,color:white</span><br><span class="line">    classDef detail fill:#9C27B0,stroke:#7B1FA2,color:white</span><br><span class="line"></span><br><span class="line">    class D,D3 process</span><br><span class="line">    class D1,D2,D21,D22,D23 detail</span><br></pre></td></tr></table></figure>

<h3 id="1-4-3-跨模态对齐阶段"><a href="#1-4-3-跨模态对齐阶段" class="headerlink" title="1.4.3 跨模态对齐阶段"></a>1.4.3 <strong>跨模态对齐阶段</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    D3[空间信息处理] --&gt; E[跨模态对齐阶段]</span><br><span class="line">    E --&gt; E1[投影层处理]</span><br><span class="line">    E1 --&gt; E2[特征维度转换]</span><br><span class="line">    E2 --&gt; E3[语义空间对齐]</span><br><span class="line"></span><br><span class="line">    classDef process fill:#2196F3,stroke:#1976D2,color:white</span><br><span class="line">    classDef detail fill:#9C27B0,stroke:#7B1FA2,color:white</span><br><span class="line"></span><br><span class="line">    class E process</span><br><span class="line">    class E1,E2,E3 detail</span><br></pre></td></tr></table></figure>

<h3 id="1-4-4-多模态融合与输入构建阶段"><a href="#1-4-4-多模态融合与输入构建阶段" class="headerlink" title="1.4.4  多模态融合与输入构建阶段"></a>1.4.4  <strong>多模态融合与输入构建阶段</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    F[多模态融合阶段] --&gt; F1[构建输入序列]</span><br><span class="line">    F1 --&gt; F11[文本指令分词处理]</span><br><span class="line">    F1 --&gt; F12[插入视觉特征标记]</span><br><span class="line">    F1 --&gt; F13[添加特殊分隔符]</span><br><span class="line"></span><br><span class="line">    classDef process fill:#2196F3,stroke:#1976D2,color:white</span><br><span class="line">    classDef detail fill:#9C27B0,stroke:#7B1FA2,color:white</span><br><span class="line">    classDef io fill:#FF5722,stroke:#E64A19,color:white</span><br><span class="line"></span><br><span class="line">    class F,F1 process</span><br><span class="line">    class F11,F12,F13 io</span><br></pre></td></tr></table></figure>

<h3 id="1-4-5大语言模型处理与推理阶段"><a href="#1-4-5大语言模型处理与推理阶段" class="headerlink" title="1.4.5大语言模型处理与推理阶段"></a>1.4.5<strong>大语言模型处理与推理阶段</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    G[大语言模型处理阶段] --&gt; G1[自注意力机制计算]</span><br><span class="line">    G1 --&gt; G2[跨模态语义理解]</span><br><span class="line">    G2 --&gt; G21[理解图像内容]</span><br><span class="line">    G2 --&gt; G22[理解任务指令]</span><br><span class="line">    G22 --&gt; G3[多模态推理]</span><br><span class="line"></span><br><span class="line">    classDef process fill:#2196F3,stroke:#1976D2,color:white</span><br><span class="line">    classDef detail fill:#9C27B0,stroke:#7B1FA2,color:white</span><br><span class="line">    classDef io fill:#FF5722,stroke:#E64A19,color:white</span><br><span class="line"></span><br><span class="line">    class G,G3 process</span><br><span class="line">    class G1,G2 detail</span><br><span class="line">    class G21,G22 io</span><br></pre></td></tr></table></figure>

<p>在此基础上，可以使用VLM来帮助程序判断识别，例如应该将滑块移动到移动到哪个位置，或者在进行汉字点选时应该按照什么顺序，点击什么位置</p>
<h2 id="1-5-常见人工验证方式"><a href="#1-5-常见人工验证方式" class="headerlink" title="1.5 常见人工验证方式"></a>1.5 常见人工验证方式</h2><h3 id="1-5-1-简单点击验证"><a href="#1-5-1-简单点击验证" class="headerlink" title="1.5.1 简单点击验证"></a>1.5.1 简单点击验证</h3><p>没有其他的验证操作，直接点击对应区域即可，可以直接交由PlayWright来操作</p>
<img src="/2025/10/15/探究通过各种绕过网易易盾人工验证的方法/image-20251107162636629.png"  alt="image-20251107162636629" style="zoom:50%;" />

<h3 id="1-5-2-拖动滑块验证"><a href="#1-5-2-拖动滑块验证" class="headerlink" title="1.5.2 拖动滑块验证"></a>1.5.2 拖动滑块验证</h3><p>平移拼图</p>
<img src="/2025/10/15/探究通过各种绕过网易易盾人工验证的方法/image-20251107162728454.png"  alt="image-20251107162728454" style="zoom:50%;" />

<p>拖动滑块后拼图会转动</p>
<img src="/2025/10/15/探究通过各种绕过网易易盾人工验证的方法/image-20251107162859269.png"  alt="image-20251107162859269" style="zoom:50%;" />

<img src="/2025/10/15/探究通过各种绕过网易易盾人工验证的方法/image-20251110142101412.png"  alt="image-20251110142101412" style="zoom:50%;" />

<h4 id="两个思路：OpenCV，VLM"><a href="#两个思路：OpenCV，VLM" class="headerlink" title="两个思路：OpenCV，VLM"></a>两个思路：OpenCV，VLM</h4><p>第一个思路：<strong>使用OpenCV进行模式识别，可以直接按照滑块的形状和缺口中的形状来进行匹配，从而判断滑块应该移动多少像素位置</strong></p>
<p>实现方法：从网页HTML中找到构成滑块验证的两个部分：滑块和带缺口的背景图，使用下面代码<strong>进行模版匹配并逐像素比较每个位置的相似度</strong>（offset &#x3D; 背景中最匹配滑块缺口的左上角横坐标），匹配位置的 <strong>x 坐标（max_loc[0]）</strong> 就是滑块验证码所需的 <strong>移动像素偏移量</strong>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_slide_offset</span>(<span class="params">background_path, slide_path, visualize=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="comment"># 读取图像</span></span><br><span class="line">    background = cv2.imread(background_path, cv2.IMREAD_GRAYSCALE)</span><br><span class="line">    slide = cv2.imread(slide_path, cv2.IMREAD_UNCHANGED)  <span class="comment"># 保留透明通道</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> background <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> FileNotFoundError(<span class="string">f&quot;背景图 <span class="subst">&#123;background_path&#125;</span> 无法读取！&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> slide <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> FileNotFoundError(<span class="string">f&quot;滑块图 <span class="subst">&#123;slide_path&#125;</span> 无法读取！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果滑块图有 Alpha 通道，提取前景部分</span></span><br><span class="line">    <span class="keyword">if</span> slide.shape[<span class="number">2</span>] == <span class="number">4</span>:</span><br><span class="line">        bgr = slide[:, :, :<span class="number">3</span>]</span><br><span class="line">        alpha = slide[:, :, <span class="number">3</span>]</span><br><span class="line">        _, mask = cv2.threshold(alpha, <span class="number">1</span>, <span class="number">255</span>, cv2.THRESH_BINARY)</span><br><span class="line">        slide_gray = cv2.cvtColor(bgr, cv2.COLOR_BGR2GRAY)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        slide_gray = cv2.cvtColor(slide, cv2.COLOR_BGR2GRAY)</span><br><span class="line">        mask = np.ones_like(slide_gray) * <span class="number">255</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 转灰度</span></span><br><span class="line">    bg_gray = background</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 二值化并裁剪滑块右侧空白部分</span></span><br><span class="line">    slide_binary = cv2.threshold(slide_gray, <span class="number">0</span>, <span class="number">255</span>, cv2.THRESH_BINARY + cv2.THRESH_OTSU)[<span class="number">1</span>]</span><br><span class="line">    cols = np.<span class="built_in">any</span>(slide_binary, axis=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> np.<span class="built_in">any</span>(cols):</span><br><span class="line">        rightmost = np.<span class="built_in">max</span>(np.where(cols))</span><br><span class="line">        crop_width = <span class="built_in">max</span>(<span class="number">5</span>, rightmost)</span><br><span class="line">        slide_cropped = slide_gray[:, :crop_width]</span><br><span class="line">        mask_cropped = mask[:, :crop_width]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        slide_cropped = slide_gray</span><br><span class="line">        mask_cropped = mask</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 边缘检测</span></span><br><span class="line">    bg_edge = cv2.Canny(bg_gray, <span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line">    slide_edge = cv2.Canny(slide_cropped, <span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 模板匹配</span></span><br><span class="line">    result = cv2.matchTemplate(bg_edge, slide_edge, cv2.TM_CCOEFF_NORMED)</span><br><span class="line">    _, max_val, _, max_loc = cv2.minMaxLoc(result)</span><br><span class="line">    offset = max_loc[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ====== 可视化结果 ======</span></span><br><span class="line">    <span class="keyword">if</span> visualize:</span><br><span class="line">        bg_color = cv2.imread(background_path)  <span class="comment"># 用彩色背景做显示</span></span><br><span class="line">        slide_rgb = cv2.imread(slide_path, cv2.IMREAD_UNCHANGED)</span><br><span class="line">        <span class="keyword">if</span> slide_rgb.shape[<span class="number">2</span>] == <span class="number">4</span>:</span><br><span class="line">            <span class="comment"># 分离通道</span></span><br><span class="line">            slide_bgr = slide_rgb[:, :, :<span class="number">3</span>]</span><br><span class="line">            alpha = slide_rgb[:, :, <span class="number">3</span>] / <span class="number">255.0</span></span><br><span class="line">            h, w = slide_bgr.shape[:<span class="number">2</span>]</span><br><span class="line">            y, x = max_loc[<span class="number">1</span>], max_loc[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 将滑块叠加到背景上</span></span><br><span class="line">            overlay = bg_color.copy()</span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">                overlay[y:y+h, x:x+w, c] = (</span><br><span class="line">                    alpha * slide_bgr[:, :, c] +</span><br><span class="line">                    (<span class="number">1</span> - alpha) * overlay[y:y+h, x:x+w, c]</span><br><span class="line">                )</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            overlay = bg_color.copy()</span><br><span class="line">            h, w = slide_rgb.shape[:<span class="number">2</span>]</span><br><span class="line">            y, x = max_loc[<span class="number">1</span>], max_loc[<span class="number">0</span>]</span><br><span class="line">            overlay[y:y+h, x:x+w] = slide_rgb</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 绘制矩形框显示匹配位置</span></span><br><span class="line">        cv2.rectangle(overlay, max_loc, (max_loc[<span class="number">0</span>] + slide_cropped.shape[<span class="number">1</span>],</span><br><span class="line">                                         max_loc[<span class="number">1</span>] + slide_cropped.shape[<span class="number">0</span>]),</span><br><span class="line">                      (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">2</span>)</span><br><span class="line">        cv2.imshow(<span class="string">&quot;show&quot;</span>, overlay)</span><br><span class="line">        cv2.waitKey(<span class="number">0</span>)</span><br><span class="line">        cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> offset, max_val, slide_cropped.shape[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===== 使用你的文件 =====</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    offset, confidence, used_width = find_slide_offset(<span class="string">&quot;cv_1.png&quot;</span>, <span class="string">&quot;cv_2.png&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;✅ 滑动像素（偏移量）: <span class="subst">&#123;offset&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;🔍 匹配置信度: <span class="subst">&#123;confidence:<span class="number">.3</span>f&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;✂️ 滑块实际匹配宽度: <span class="subst">&#123;used_width&#125;</span> 像素&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;❌ 错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>缺陷：对于<strong>带旋转的滑块验证，这种逐一比对的方法就不适用了</strong>，因为此方法只能固定从左到右去平移来匹配（当然可以考虑在平移过程中加上旋转，但是这样如果后面有其他情况有需要考虑代码修改），因此下面提出第二种方法：使用大模型来判断滑块是否滑动到位</p>
<p>第二个思路：<strong>使用VLM+提示词，当用户每次滑动一段距离，进行页面截图传回给VLM，由VLM来判断是否到位，针对性的进行微调</strong>，这样能够适应大部分滑块验证场景，不用考虑旋转等问题</p>
<p>简单在<a target="_blank" rel="noopener" href="https://chat.qwen.ai/">Qwen</a>中示例：</p>
<img src="/2025/10/15/探究通过各种绕过网易易盾人工验证的方法/image-20251110144548753.png"  alt="image-20251110144548753" style="zoom:50%;" />

<img src="/2025/10/15/探究通过各种绕过网易易盾人工验证的方法/image-20251110144617315.png"  alt="image-20251110144617315" style="zoom:50%;" />

<h3 id="1-5-3-点选文字验证"><a href="#1-5-3-点选文字验证" class="headerlink" title="1.5.3 点选文字验证"></a>1.5.3 点选文字验证</h3><p>按照顺序点选</p>
<img src="/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/image-20251107162947583.png" class="" title="image-20251107162947583">

<p>按照能否组成四字成语点选</p>
<img src="/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/image-20251107163029570.png" class="" title="image-20251107163029570">

<p><strong>对于点选式验证码的问题，我们可以将其拆解为两个小问题：</strong></p>
<p><strong>1、确定需要点击的字的数量和位置：</strong> 对于点选式验证码，准确识别和定位需要点击的字的数量和位置是解决问题的关键。   其中，一种常见的目标检测算法是 YOLO，通过标注数据集和训练模型，可以实现对需要点击的字进行准确识别和定位。</p>
<p><strong>2、对点击的字进行排序：</strong> 在确定出需要点击的字的位置后，需要按照一定的规则对这些字进行排序。采用传统的方案是通过识别图片中的文字，然后按照文字位置进行排序，但这种方法训练困难。因此，本项目采用了图片匹配模型，使用 Siamese 孪生网络对需要点击的字与预先准备好的字库中的字进行匹配，找到最佳匹配的字，并按照一定的规则进行排序。Siamese 孪生网络在图像匹配方面表现优异，能够有效地提高排序的准确性和稳定性。</p>
<h4 id="尝试用三种方案来实现：OCR、VLM、YOLO-Siamese孪生网络"><a href="#尝试用三种方案来实现：OCR、VLM、YOLO-Siamese孪生网络" class="headerlink" title="尝试用三种方案来实现：OCR、VLM、YOLO+Siamese孪生网络"></a><strong>尝试用三种方案来实现：OCR、VLM、YOLO</strong>+Siamese孪生网络</h4><p><strong>OCR（失败）：</strong></p>
<p>OCR能识别文字，是因为它通过图像预处理提升文字清晰度，再利用文本检测定位图像中的文字区域，接着通过字符分割（或端到端深度学习模型）将图像中的字符转化为机器可理解的特征，最后借助分类器或神经网络识别出对应的文字，并结合语言模型进行后处理纠错，从而实现从图像到可编辑文本的转换。</p>
<p>由于复杂的背景和颜色融合综合程度较深，OCR无法有效提取到文本进行后续操作，导致识别失败</p>
<img src="/2025/10/15/探究通过各种绕过网易易盾人工验证的方法/image-20251110150717590.png"  alt="image-20251110150717590" style="zoom:50%;" />

<p><strong>VLM（成功，但是仍然会存在识别不出来或者坐标偏差大的情况）：</strong></p>
<p>使用VLM＋提示词，将识别目标坐标以json格式输出，再后续操作进行解析即可操作</p>
<p>调整  “temperature”: 0,”top_k”: 1两个参数，保障每次输出结果稳定</p>
<p>优化方案：通过修改提示词可以优化识别效果，但是不同场景下同一套提示词可能效果偏差会比较大</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># === 配置区 ===</span></span><br><span class="line">API_KEY = <span class="string">&quot;sk---qyjg&quot;</span></span><br><span class="line">MODEL_NAME = <span class="string">&quot;Qwen/Qwen2.5-VL-32B-Instruct&quot;</span></span><br><span class="line">API_URL = <span class="string">&quot;https://api.siliconflow.cn/v1/chat/completions&quot;</span>  <span class="comment"># 修正：删除末尾空格</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">image_to_base64</span>(<span class="params">image_path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(image_path, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> base64.b64encode(f.read()).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_json_fallback</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> json.loads(text)</span><br><span class="line">    <span class="keyword">except</span> json.JSONDecodeError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    pattern = <span class="string">r&#x27;\&#123;\s*&quot;text&quot;\s*:\s*&quot;([^&quot;]*)&quot;\s*,\s*&quot;x&quot;\s*:\s*(\d+\.?\d*)\s*,\s*&quot;y&quot;\s*:\s*(\d+\.?\d*)\s*\&#125;&#x27;</span></span><br><span class="line">    matches = re.findall(pattern, text)</span><br><span class="line">    <span class="keyword">if</span> matches:</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            &#123;<span class="string">&quot;text&quot;</span>: m[<span class="number">0</span>], <span class="string">&quot;x&quot;</span>: <span class="built_in">float</span>(m[<span class="number">1</span>]), <span class="string">&quot;y&quot;</span>: <span class="built_in">float</span>(m[<span class="number">2</span>])&#125;</span><br><span class="line">            <span class="keyword">for</span> m <span class="keyword">in</span> matches</span><br><span class="line">        ]</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recognize_click_captcha</span>(<span class="params">image_path</span>):</span><br><span class="line">    base64_image = image_to_base64(image_path)</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;API_KEY&#125;</span>&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    prompt = (</span><br><span class="line">        <span class="string">&quot;你是一个验证码识别系统。请仔细阅读图像下方的文字指令，并严格按照指令中要求的顺序，识别并返回对应文字的中心像素坐标（以图像左上角为原点）。\n&quot;</span></span><br><span class="line">        <span class="comment"># &quot;当前指令你需要自己在图中找寻找&quot;</span></span><br><span class="line">        <span class="string">&quot;先确定上面图片的尺寸，然后用一个方框定位图片里所有中文字的位置，最后依次输出全 验 扩 三个字的位置。&quot;</span></span><br><span class="line">        <span class="string">&quot;要求：\n&quot;</span></span><br><span class="line">        <span class="string">&quot;1. 只输出 JSON 列表，不要任何解释。\n&quot;</span></span><br><span class="line">        <span class="string">&quot;2. 每个元素包含 &#x27;text&#x27;（文字内容）、&#x27;x&#x27;（中心x坐标）、&#x27;y&#x27;（中心y坐标）。\n&quot;</span></span><br><span class="line">        <span class="string">&quot;3. 坐标必须是数字，不要单位。\n&quot;</span></span><br><span class="line">        <span class="string">&quot;4. 输出列表的顺序必须与指令中文字出现的顺序完全一致。\n&quot;</span></span><br><span class="line">        <span class="string">&quot;示例输出：[&#123;\&quot;text\&quot;: \&quot;全\&quot;, \&quot;x\&quot;: 573.0, \&quot;y\&quot;: 621.0&#125;, &#123;\&quot;text\&quot;: \&quot;来\&quot;, \&quot;x\&quot;: 94.0, \&quot;y\&quot;: 554.0&#125;, &#123;\&quot;text\&quot;: \&quot;库\&quot;, \&quot;x\&quot;: 308.0, \&quot;y\&quot;: 223.0&#125;]&quot;</span></span><br><span class="line"></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&quot;model&quot;</span>: MODEL_NAME,</span><br><span class="line">        <span class="string">&quot;messages&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">                    &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;text&quot;</span>: prompt&#125;,</span><br><span class="line">                    &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;image_url&quot;</span>, <span class="string">&quot;image_url&quot;</span>: &#123;<span class="string">&quot;url&quot;</span>: <span class="string">f&quot;data:image/png;base64,<span class="subst">&#123;base64_image&#125;</span>&quot;</span>&#125;&#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;temperature&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;top_k&quot;</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.post(API_URL, headers=headers, json=payload, timeout=<span class="number">30</span>)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        data = response.json()</span><br><span class="line">        content = data[<span class="string">&quot;choices&quot;</span>][<span class="number">0</span>][<span class="string">&quot;message&quot;</span>][<span class="string">&quot;content&quot;</span>].strip()</span><br><span class="line">        result = parse_json_fallback(content)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[Error] Recognition failed: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">visualize_detections</span>(<span class="params">image_path, detections</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    在原图上绘制文字和坐标点，并弹窗显示（不保存）</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    image = Image.<span class="built_in">open</span>(image_path).convert(<span class="string">&quot;RGB&quot;</span>)</span><br><span class="line">    draw = ImageDraw.Draw(image)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 尝试加载系统中文字体（避免乱码），若失败则用默认字体</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 常见中文字体路径（按优先级尝试）</span></span><br><span class="line">        font_paths = [</span><br><span class="line">            <span class="string">&quot;/System/Library/Fonts/PingFang.ttc&quot;</span>,   <span class="comment"># macOS</span></span><br><span class="line">            <span class="string">&quot;/usr/share/fonts/truetype/wqy/wqy-zenhei.ttc&quot;</span>,  <span class="comment"># Linux</span></span><br><span class="line">            <span class="string">&quot;C:/Windows/Fonts/msyh.ttc&quot;</span>,            <span class="comment"># Windows 微软雅黑</span></span><br><span class="line">            <span class="string">&quot;C:/Windows/Fonts/simsun.ttc&quot;</span>,          <span class="comment"># 宋体</span></span><br><span class="line">        ]</span><br><span class="line">        font = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> fp <span class="keyword">in</span> font_paths:</span><br><span class="line">            <span class="keyword">if</span> os.path.exists(fp):</span><br><span class="line">                font = ImageFont.truetype(fp, size=<span class="number">24</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> font <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            font = ImageFont.load_default()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        font = ImageFont.load_default()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 绘制每个检测结果</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> detections:</span><br><span class="line">        x, y = item[<span class="string">&quot;x&quot;</span>], item[<span class="string">&quot;y&quot;</span>]</span><br><span class="line">        text = item[<span class="string">&quot;text&quot;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 画一个红色圆点（半径5）</span></span><br><span class="line">        draw.ellipse((x - <span class="number">5</span>, y - <span class="number">5</span>, x + <span class="number">5</span>, y + <span class="number">5</span>), fill=<span class="string">&quot;red&quot;</span>, outline=<span class="string">&quot;red&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 在坐标上方绘制文字（白色带黑边，增强可读性）</span></span><br><span class="line">        bbox = draw.textbbox((x, y - <span class="number">30</span>), text, font=font)</span><br><span class="line">        <span class="comment"># 黑边</span></span><br><span class="line">        draw.text((x - <span class="number">1</span>, y - <span class="number">31</span>), text, fill=<span class="string">&quot;black&quot;</span>, font=font)</span><br><span class="line">        draw.text((x + <span class="number">1</span>, y - <span class="number">31</span>), text, fill=<span class="string">&quot;black&quot;</span>, font=font)</span><br><span class="line">        draw.text((x, y - <span class="number">32</span>), text, fill=<span class="string">&quot;black&quot;</span>, font=font)</span><br><span class="line">        draw.text((x, y - <span class="number">30</span>), text, fill=<span class="string">&quot;black&quot;</span>, font=font)</span><br><span class="line">        <span class="comment"># 白色文字</span></span><br><span class="line">        draw.text((x, y - <span class="number">31</span>), text, fill=<span class="string">&quot;white&quot;</span>, font=font)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用 matplotlib 显示（避免 Pillow show() 在某些环境不弹窗）</span></span><br><span class="line">    plt.figure(figsize=(<span class="number">10</span>, <span class="number">8</span>))</span><br><span class="line">    plt.imshow(image)</span><br><span class="line">    plt.axis(<span class="string">&quot;off&quot;</span>)</span><br><span class="line">    plt.title(<span class="string">&quot;文字点选识别结果&quot;</span>, fontsize=<span class="number">14</span>)</span><br><span class="line">    plt.tight_layout()</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># === 主程序 ===</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    image_path = <span class="string">&quot;world_1.png&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(image_path):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;错误：图像文件 <span class="subst">&#123;image_path&#125;</span> 不存在！&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        detections = recognize_click_captcha(image_path)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;识别结果:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> detections:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;文字: <span class="subst">&#123;item[<span class="string">&#x27;text&#x27;</span>]&#125;</span>, 坐标: (<span class="subst">&#123;item[<span class="string">&#x27;x&#x27;</span>]:<span class="number">.1</span>f&#125;</span>, <span class="subst">&#123;item[<span class="string">&#x27;y&#x27;</span>]:<span class="number">.1</span>f&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 可视化（不保存）</span></span><br><span class="line">        visualize_detections(image_path, detections)</span><br></pre></td></tr></table></figure>

<p>可以看到虽然效果会比OCR提升很多，但是仍然存在偏差，考录还是背景太复杂的原因</p>
<img src="/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/image-20251110152036751.png" class="" title="image-20251110152036751">

<p><strong>YOLO+Siamese孪生网络（成功，且对一般目标效果较好）</strong></p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/MgArcher/Text_select_captcha">Text_select_captcha</a></p>
<p><strong>yolov5训练过程：</strong><br>训练流程一般包括如下几个步骤：获取训练数据集、数据预处理、模型选择、设置损失函数、反向传播和更新权值等。</p>
<p><strong>使用lambeling标注char和target</strong></p>
<img src="/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/image-20251110152758487.png" class="" title="image-20251110152758487">

<p>接下来是选择合适的模型。YOLO 系列模型有多个版本，可以根据不同的需求选择适合的版本。选择好模型后，需要设置损失函数和训练参数，进行模型训练。</p>
<p><strong>YOLO检测结果</strong></p>
<img src="/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/image-20251110153000949.png" class="" title="image-20251110153000949">

<p>使用<strong>孪生网络</strong>进行图像检索任务的训练前，需要对数据集进行准备。与其他模型不同，<strong>孪生网络的训练需要用到正负样本对，因此需要对数据集中的每张图像都生成一些与之匹配和不匹配的样本对。</strong></p>
<p>具体实现时，一般采用已经训练好的检测模型来生成样本对。</p>
<p>具体操作流程如下：首先，使用检测模型对数据集中的图像进行检测，截取出每个目标的图像片段；然后，把该图像片段分别与数据集中的其他目标进行匹配和不匹配的组合，形成匹配和不匹配的样本对；最后，根据样本对的匹配情况对其进行标注，将匹配和不匹配的样本对分别放到不同的文件夹中，按照类别和顺序标注好，方便后续使用。</p>
<p><strong>如下图所示，每张图像都会对应一个匹配和不匹配的样本对，每个样本对包含两张图像，分别作为孪生网络的输入。</strong></p>
<p><strong>孪生网络标注结果</strong></p>
<img src="/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/image-20251110153053321.png" class="" title="image-20251110153053321">

<p><strong>孪生网络识别结果：</strong></p>
<img src="/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/image-20251110153204321.png" class="" title="image-20251110153204321">

<p>如图所示，<strong>孪生网络输出的结果可以给出背景图中的目标与右下角的目标最相似的结果，而左下角的目标则可以通过按照左坐标进行排序来得到。由此，可以方便地得到背景图中所有目标的顺序。</strong></p>
<p>识别效果：</p>
<p>根据页面截图降低分辨率后仍然可以检测到目标，并且判断点击顺序</p>
<img src="/2025/10/15/探究通过各种绕过网易易盾人工验证的方法/image-20251110153900090.png"  alt="image-20251110153900090" style="zoom:50%;" />

<h3 id="1-5-4-躲避障碍"><a href="#1-5-4-躲避障碍" class="headerlink" title="1.5.4 躲避障碍"></a>1.5.4 躲避障碍</h3><img src="/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/image-20251107163109355.png" class="" title="image-20251107163109355">

<h4 id="实现方案：将图片转灰度-VLM-路径设计算法"><a href="#实现方案：将图片转灰度-VLM-路径设计算法" class="headerlink" title="实现方案：将图片转灰度+VLM+路径设计算法"></a>实现方案：将图片转灰度+VLM+路径设计算法</h4><p>首先调用多模态大模型对输入图像进行分析，<strong>自动识别出其中所有与背景明显区分的漂浮图标</strong>，并<strong>输出每个图标的相对坐标、中心点和大小</strong>；随后将识别结果转换为像素坐标，在图像上绘制标注。接着，程<strong>序以左下角为起点、指定图标为目标点，利用人工势场法模拟小球运动，通过计算目标的吸引力和图标的排斥力，使小球在避开障碍物的同时逐步接近目标点，当到达目标区域后停止运动，最终生成带有路径轨迹的图像输出。</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ====================== 配置 ======================</span></span><br><span class="line">API_KEY = <span class="string">&quot;sk-mclrnhhztfcdhkjejcasedatzlxwadgcwodfhdsypzftqyjg&quot;</span></span><br><span class="line">BASE_URL = <span class="string">&quot;https://api.siliconflow.cn/v1/chat/completions&quot;</span></span><br><span class="line">MODEL_NAME = <span class="string">&quot;Qwen/Qwen2.5-VL-72B-Instruct&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ====================== 工具函数 ======================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">image_to_base64</span>(<span class="params">image_path</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;读取图片并转为Base64&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(image_path, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> base64.b64encode(f.read()).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ratio_to_pixel_coords</span>(<span class="params">bbox_ratio, center_ratio, width, height</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    严格按比例将 bbox_ratio 转换为像素坐标，</span></span><br><span class="line"><span class="string">    同时返回中心点和包围框宽高。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    x1 = <span class="built_in">int</span>(<span class="built_in">round</span>(bbox_ratio[<span class="number">0</span>] * width))</span><br><span class="line">    y1 = <span class="built_in">int</span>(<span class="built_in">round</span>(bbox_ratio[<span class="number">1</span>] * height))</span><br><span class="line">    x2 = <span class="built_in">int</span>(<span class="built_in">round</span>(bbox_ratio[<span class="number">2</span>] * width))</span><br><span class="line">    y2 = <span class="built_in">int</span>(<span class="built_in">round</span>(bbox_ratio[<span class="number">3</span>] * height))</span><br><span class="line">    cx = <span class="built_in">int</span>(<span class="built_in">round</span>(center_ratio[<span class="number">0</span>] * width))</span><br><span class="line">    cy = <span class="built_in">int</span>(<span class="built_in">round</span>(center_ratio[<span class="number">1</span>] * height))</span><br><span class="line">    w_px = x2 - x1</span><br><span class="line">    h_px = y2 - y1</span><br><span class="line">    <span class="keyword">return</span> (x1, y1, x2, y2, cx, cy, w_px, h_px)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ====================== 核心提示词 ======================</span></span><br><span class="line">prompt_text = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">你是一名专业的图像分析专家。你的任务是识别图片中所有**漂浮的图标（与背景明显区分的封闭形状）**，并输出它们的相对位置与大小。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">请严格按照以下步骤执行：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. **识别所有图标：**</span></span><br><span class="line"><span class="string">   - 扫描整张图片，检测出所有独立的、边界清晰的漂浮图标。</span></span><br><span class="line"><span class="string">   - 图标颜色可能是白色或者黑色，必须与背景有显著的对比（如亮度或颜色差异）。</span></span><br><span class="line"><span class="string">   - 图标必须是封闭形状，且与背景在纹理或色彩上明显区分。</span></span><br><span class="line"><span class="string">   - 排除非独立对象。背景中的非图标元素，尤其是结构性元素，任何其他可能与图标混淆的区域。</span></span><br><span class="line"><span class="string">   - 为每个有效图标生成唯一标识符（icon_1, icon_2, …），按从左到右、从上到下的顺序排序。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. **计算每个图标的比例坐标与大小：**</span></span><br><span class="line"><span class="string">   - bbox_ratio: [x1, y1, x2, y2]   # 图标包围盒左上角与右下角的比例坐标（范围 0~1）</span></span><br><span class="line"><span class="string">   - center_ratio: [cx, cy]         # 图标中心点的准确比例坐标（范围 0~1）</span></span><br><span class="line"><span class="string">   - size_ratio: [w, h]             # 包围盒的宽高比例（w = x2 - x1，h = y2 - y1）</span></span><br><span class="line"><span class="string">   - 坐标的精度必须准确到小数点后至少四位。</span></span><br><span class="line"><span class="string">   - 所有坐标与尺寸都应基于整张图片的宽高计算。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. **排除干扰因素：**</span></span><br><span class="line"><span class="string">   - 请确保仅识别漂浮的图标，排除背景中的非图标元素，尤其是结构性元素，如树木、建筑或任何其他可能与图标混淆的区域。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4. **输出要求：**</span></span><br><span class="line"><span class="string">   - 仅输出标准 JSON 格式。</span></span><br><span class="line"><span class="string">   - 不要输出任何说明、注释或多余文字。</span></span><br><span class="line"><span class="string">   - 输出格式必须严格如下：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;icons&quot;: [</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;id&quot;: &quot;icon_1&quot;,</span></span><br><span class="line"><span class="string">      &quot;bbox_ratio&quot;: [x1, y1, x2, y2],</span></span><br><span class="line"><span class="string">      &quot;center_ratio&quot;: [cx, cy],</span></span><br><span class="line"><span class="string">      &quot;size_ratio&quot;: [w, h]</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;id&quot;: &quot;icon_2&quot;,</span></span><br><span class="line"><span class="string">      &quot;bbox_ratio&quot;: [x1, y1, x2, y2],</span></span><br><span class="line"><span class="string">      &quot;center_ratio&quot;: [cx, cy],</span></span><br><span class="line"><span class="string">      &quot;size_ratio&quot;: [w, h]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ====================== 主执行逻辑 ======================</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 1️⃣ 获取输入图片路径</span></span><br><span class="line">    IMAGE_PATH = sys.argv[<span class="number">1</span>] <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="string">&quot;preprocessed.png&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2️⃣ 加载原图</span></span><br><span class="line">    original_img = Image.<span class="built_in">open</span>(IMAGE_PATH).convert(<span class="string">&quot;RGB&quot;</span>)</span><br><span class="line">    width, height = original_img.size</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;✅ 已加载原图，尺寸为: <span class="subst">&#123;original_img.size&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3️⃣ 构造请求</span></span><br><span class="line">    messages = [&#123;</span><br><span class="line">        <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">            &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;text&quot;</span>: prompt_text&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;image_url&quot;</span>, <span class="string">&quot;image_url&quot;</span>: &#123;<span class="string">&quot;url&quot;</span>: <span class="string">f&quot;data:image/png;base64,<span class="subst">&#123;image_to_base64(IMAGE_PATH)&#125;</span>&quot;</span>&#125;&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;]</span><br><span class="line">    headers = &#123;<span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;API_KEY&#125;</span>&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>&#125;</span><br><span class="line">    payload = &#123;<span class="string">&quot;model&quot;</span>: MODEL_NAME, <span class="string">&quot;messages&quot;</span>: messages, <span class="string">&quot;temperature&quot;</span>: <span class="number">0.0</span>, <span class="string">&quot;top_k&quot;</span>: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4️⃣ 发送请求</span></span><br><span class="line">    response = requests.post(BASE_URL, headers=headers, json=payload)</span><br><span class="line">    <span class="keyword">if</span> response.status_code != <span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;❌ 请求失败：<span class="subst">&#123;response.status_code&#125;</span> - <span class="subst">&#123;response.text&#125;</span>&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5️⃣ 解析响应</span></span><br><span class="line">    raw_answer = response.json()[<span class="string">&quot;choices&quot;</span>][<span class="number">0</span>][<span class="string">&quot;message&quot;</span>][<span class="string">&quot;content&quot;</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;模型原始输出：\n&quot;</span>, raw_answer)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> = re.search(<span class="string">r&quot;\&#123;.*\&#125;&quot;</span>, raw_answer, re.S)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">match</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;❌ 未检测到有效的JSON内容。&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    answer = <span class="keyword">match</span>.group(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = json.loads(answer)</span><br><span class="line">    <span class="keyword">except</span> json.JSONDecodeError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;❌ JSON解析失败:&quot;</span>, e)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;清理后内容:&quot;</span>, <span class="built_in">repr</span>(answer))</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6️⃣ 提取关键数据</span></span><br><span class="line">    icons = data.get(<span class="string">&quot;icons&quot;</span>, [])</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> icons:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;❌ 未检测到任何图标。&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;✅ 检测到 <span class="subst">&#123;<span class="built_in">len</span>(icons)&#125;</span> 个图标。&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 7️⃣ 绘制检测结果</span></span><br><span class="line">    draw = ImageDraw.Draw(original_img)</span><br><span class="line">    results = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> icon <span class="keyword">in</span> icons:</span><br><span class="line">        bbox_ratio = icon.get(<span class="string">&quot;bbox_ratio&quot;</span>)</span><br><span class="line">        center_ratio = icon.get(<span class="string">&quot;center_ratio&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> bbox_ratio <span class="keyword">or</span> <span class="keyword">not</span> center_ratio:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 转换为像素坐标</span></span><br><span class="line">        x1, y1, x2, y2, cx, cy, w_px, h_px = ratio_to_pixel_coords(bbox_ratio, center_ratio, width, height)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 绘制矩形与中心点</span></span><br><span class="line">        draw.rectangle([(x1, y1), (x2, y2)], outline=<span class="string">&quot;lime&quot;</span>, width=<span class="number">3</span>)</span><br><span class="line">        draw.ellipse([(cx - <span class="number">4</span>, cy - <span class="number">4</span>), (cx + <span class="number">4</span>, cy + <span class="number">4</span>)], fill=<span class="string">&quot;blue&quot;</span>, outline=<span class="string">&quot;white&quot;</span>, width=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 保存结果</span></span><br><span class="line">        results.append(&#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: icon.get(<span class="string">&quot;id&quot;</span>),</span><br><span class="line">            <span class="string">&quot;center_pixel&quot;</span>: [cx, cy],</span><br><span class="line">            <span class="string">&quot;bbox_pixel&quot;</span>: [x1, y1, x2, y2],</span><br><span class="line">            <span class="string">&quot;size_pixel&quot;</span>: [w_px, h_px]</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 8️⃣ 输出最终结果</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n================= 最终结果 =================&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(json.dumps(results, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 9️⃣ 保存标注图</span></span><br><span class="line">    output_path = <span class="string">&quot;annotated_&quot;</span> + IMAGE_PATH</span><br><span class="line">    original_img.save(output_path)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;✅ 标注完成！结果已保存为: <span class="subst">&#123;output_path&#125;</span>&quot;</span>)</span><br><span class="line">    original_img.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ====================== 避障路线模拟 ======================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">simulate_safe_path</span>(<span class="params">img, icons, step_size=<span class="number">8</span>, max_steps=<span class="number">2000</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    模拟小球从左下角移动到第三个目标点，尽可能避开障碍物。</span></span><br><span class="line"><span class="string">    使用人工势场法（Potential Field）。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    width, height = img.size</span><br><span class="line">    draw = ImageDraw.Draw(img)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(icons) &lt; <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;❌ 无法获取第三个目标点！&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># === 定义起点与目标 ===</span></span><br><span class="line">    sx, sy = width * <span class="number">0.05</span>, height * <span class="number">0.95</span>   <span class="comment"># 左下角起点</span></span><br><span class="line">    gx, gy = icons[<span class="number">2</span>][<span class="string">&quot;center_pixel&quot;</span>]       <span class="comment"># 目标点</span></span><br><span class="line">    path = [(sx, sy)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># === 势场参数 ===</span></span><br><span class="line">    K_att = <span class="number">1.2e-3</span>         <span class="comment"># 吸引力系数</span></span><br><span class="line">    K_rep = <span class="number">5e2</span>            <span class="comment"># 排斥力系数</span></span><br><span class="line">    influence_radius = <span class="number">80</span>  <span class="comment"># 障碍物影响半径</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># === 设置到达判定阈值（越小越精确）===</span></span><br><span class="line">    goal_threshold = <span class="number">2</span>    <span class="comment"># 小球与目标距离小于此值时认为到达</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> step <span class="keyword">in</span> <span class="built_in">range</span>(max_steps):</span><br><span class="line">        <span class="comment"># 吸引力</span></span><br><span class="line">        dx = gx - sx</span><br><span class="line">        dy = gy - sy</span><br><span class="line">        dist_goal = math.hypot(dx, dy)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ✅ 如果小球到达目标附近，立即停止</span></span><br><span class="line">        <span class="keyword">if</span> dist_goal &lt;= goal_threshold:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;✅ 已到达目标区域（步数 <span class="subst">&#123;step&#125;</span>，剩余距离 <span class="subst">&#123;dist_goal:<span class="number">.2</span>f&#125;</span> 像素）！&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        fx = K_att * dx</span><br><span class="line">        fy = K_att * dy</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 排斥力（避障）</span></span><br><span class="line">        <span class="keyword">for</span> icon <span class="keyword">in</span> icons:</span><br><span class="line">            x1, y1, x2, y2 = icon[<span class="string">&quot;bbox_pixel&quot;</span>]</span><br><span class="line">            cx = (x1 + x2) / <span class="number">2</span></span><br><span class="line">            cy = (y1 + y2) / <span class="number">2</span></span><br><span class="line">            dist = math.hypot(sx - cx, sy - cy)</span><br><span class="line">            <span class="keyword">if</span> dist &lt; influence_radius <span class="keyword">and</span> dist &gt; <span class="number">1</span>:  <span class="comment"># 避免除0</span></span><br><span class="line">                rep = K_rep * (<span class="number">1.0</span> / dist - <span class="number">1.0</span> / influence_radius) / (dist ** <span class="number">2</span>)</span><br><span class="line">                fx += rep * (sx - cx)</span><br><span class="line">                fy += rep * (sy - cy)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 更新位置</span></span><br><span class="line">        norm = math.hypot(fx, fy)</span><br><span class="line">        <span class="keyword">if</span> norm == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;⚠️ 力场平衡，停止移动。&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        sx += step_size * fx / norm</span><br><span class="line">        sy += step_size * fy / norm</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 防止越界</span></span><br><span class="line">        sx = <span class="built_in">max</span>(<span class="number">0</span>, <span class="built_in">min</span>(width - <span class="number">1</span>, sx))</span><br><span class="line">        sy = <span class="built_in">max</span>(<span class="number">0</span>, <span class="built_in">min</span>(height - <span class="number">1</span>, sy))</span><br><span class="line">        path.append((sx, sy))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># === 绘制轨迹 ===</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(path) - <span class="number">1</span>):</span><br><span class="line">        draw.line([path[i], path[i + <span class="number">1</span>]], fill=<span class="string">&quot;cyan&quot;</span>, width=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 起点终点标注</span></span><br><span class="line">    draw.ellipse([(path[<span class="number">0</span>][<span class="number">0</span>] - <span class="number">6</span>, path[<span class="number">0</span>][<span class="number">1</span>] - <span class="number">6</span>), (path[<span class="number">0</span>][<span class="number">0</span>] + <span class="number">6</span>, path[<span class="number">0</span>][<span class="number">1</span>] + <span class="number">6</span>)], fill=<span class="string">&quot;blue&quot;</span>)</span><br><span class="line">    draw.ellipse([(gx - <span class="number">6</span>, gy - <span class="number">6</span>), (gx + <span class="number">6</span>, gy + <span class="number">6</span>)], fill=<span class="string">&quot;red&quot;</span>)</span><br><span class="line"></span><br><span class="line">    img.save(<span class="string">&quot;path_simulated.png&quot;</span>)</span><br><span class="line">    img.show()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;✅ 路线模拟完成，共 <span class="subst">&#123;<span class="built_in">len</span>(path)&#125;</span> 步，结果保存为 path_simulated.png&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ====================== 执行避障路线模拟 ======================</span></span><br><span class="line">simulate_safe_path(original_img, results)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/image-20251110163928080-177071512234826.png" class="" title="image-20251110163928080">

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">kukudelin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/">http://example.com/2025/10/15/%E6%8E%A2%E7%A9%B6%E9%80%9A%E8%BF%87%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E7%BD%91%E6%98%93%E6%98%93%E7%9B%BE%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">小牛壮士</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/%E6%96%87%E7%AB%A0%E9%BB%98%E8%AE%A4%E5%B0%81%E9%9D%A2.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/10/17/%E6%96%87%E6%9C%AC%E8%87%AA%E5%8A%A8%E6%A0%87%E6%B3%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/" title="文本自动标注系统设计文档"><img class="cover" src="/img/%E6%96%87%E7%AB%A0%E9%BB%98%E8%AE%A4%E5%B0%81%E9%9D%A2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">文本自动标注系统设计文档</div></div><div class="info-2"><div class="info-item-1">前言在网络安全运营中，安全团队每天要处理大量非结构化的文本信息，包括告警日志、威胁情报、工单描述等，这些内容往往语言表达多样、标签层级复杂，传统依赖规则或监督学习的方法难以高效应对。本系统聚焦于解决实际运营中几类典型问题：例如自动识别一段文本是否来自外部研究机构的情报，判断其中是否描述了特定攻击手法，并能将其准确归入“威胁情报 → 情报来源类型 → 外部订阅 → research_feed”这样的嵌套标签路径中，从而支撑后续研判、归因与响应。 目前系统仍有不少问题尚未覆盖：  生成样本的质量受限于大模型提示词的单一性，可能存在事实错误或语义偏差； 置信度评估机制较为简化，对边界模糊或语义接近但标签不同的情况缺乏可靠的不确定性判断能力。  该系统的设计遵循以下流程，总的概括为几个步骤：  调用大模型接口生成初始文本切片以及标注数据 将切片数据embedding后连同原文本和标签一同存入Milvus数据库 基于ANN对用户输入的结构化标签进行四层分层检索策略 将检索后返回的最相似的文本标签作为输入切片的标签 计算新标签的置信度confidence 将新数据存入数据库    一、原始向...</div></div></div></a><a class="pagination-related" href="/2025/10/09/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AEDeepAnalyze%E9%83%A8%E7%BD%B2%E5%8E%86%E7%A8%8B/" title="开源项目DeepAnalyze部署历程"><img class="cover" src="/img/%E6%96%87%E7%AB%A0%E9%BB%98%E8%AE%A4%E5%B0%81%E9%9D%A2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">开源项目DeepAnalyze部署历程</div></div><div class="info-2"><div class="info-item-1">前言DeepAnalyze 是由中国人民大学数据与智能实验室推出的首个面向自主数据科学的智能体大语言模型（Agentic LLM），能够无需人工干预，端到端自动完成包括数据准备、分析、建模、可视化和报告生成在内的完整数据科学流程，支持结构化、半结构化和非结构化等多种数据源，并完全开源模型、代码、训练数据与演示系统，便于本地部署和二次开发。 本地部署配置GPU：RTX 3090(24GB) * 1 CPU：12 vCPU Intel(R) Xeon(R) Platinum 8255C CPU @ 2.50GHz 内存：43GB 硬盘：系统盘:30 GB 部署步骤1，将DeepAnalyze-8B下载到DeepAnalyze-main&#x2F;models文件夹 2，更改max_tokens（降低模型性能，视情况）   3，下载依赖包（可以把数据分析常用的依赖包也加进去，因为webUI运行代码时可能不会自动下载依赖包，会导致运行失败，后续也需要手动pip） 1pip install -r requirements.txt  4，如果需要构建 OpenAI 风格的 API，那么修改d...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">kukudelin</div><div class="author-info-description">林勇的个人博客</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">53</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/p98453"><i class="fab fa-github"></i><span>个人开源项目🎯</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://blog.csdn.net/hdsbdjsjsbs?type=blog" target="_blank" title="CSDN"><i class="fa-solid fa-blog fa-bounce" style="color: #fc5531;"></i></a><a class="social-icon" href="mailto:3224688576@qq.com" target="_blank" title="Email"><i class="fa-brands fa-qq fa-bounce" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的小站</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">前言：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81VL%E5%A4%A7%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">一、VL大模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%AE%9A%E4%B9%89"><span class="toc-number">2.1.</span> <span class="toc-text">1.1 定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">1.2 核心组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%90%86%E8%A7%A3%E5%9B%BE%E5%83%8F%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-number">2.3.</span> <span class="toc-text">1.3 大模型理解图像的流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-%E5%9B%BE%E5%83%8F%E9%A2%84%E5%A4%84%E7%90%86%E9%98%B6%E6%AE%B5"><span class="toc-number">2.3.1.</span> <span class="toc-text">1.3.1 图像预处理阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96%E9%98%B6%E6%AE%B5"><span class="toc-number">2.3.2.</span> <span class="toc-text">1.3.2 特征提取阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3-%E8%B7%A8%E6%A8%A1%E6%80%81%E5%AF%B9%E9%BD%90%E9%98%B6%E6%AE%B5"><span class="toc-number">2.3.3.</span> <span class="toc-text">1.3.3 跨模态对齐阶段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E5%9B%BE%E8%A7%A3%E5%90%84%E4%B8%AA%E9%83%A8%E5%88%86%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">2.4.</span> <span class="toc-text">1.4 图解各个部分处理流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-1-%E5%9B%BE%E5%83%8F%E9%A2%84%E5%A4%84%E7%90%86%E9%98%B6%E6%AE%B5"><span class="toc-number">2.4.1.</span> <span class="toc-text">1.4.1 图像预处理阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-2%E8%A7%86%E8%A7%89%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96%E9%98%B6%E6%AE%B5"><span class="toc-number">2.4.2.</span> <span class="toc-text">1.4.2视觉特征提取阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-3-%E8%B7%A8%E6%A8%A1%E6%80%81%E5%AF%B9%E9%BD%90%E9%98%B6%E6%AE%B5"><span class="toc-number">2.4.3.</span> <span class="toc-text">1.4.3 跨模态对齐阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-4-%E5%A4%9A%E6%A8%A1%E6%80%81%E8%9E%8D%E5%90%88%E4%B8%8E%E8%BE%93%E5%85%A5%E6%9E%84%E5%BB%BA%E9%98%B6%E6%AE%B5"><span class="toc-number">2.4.4.</span> <span class="toc-text">1.4.4  多模态融合与输入构建阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-5%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E5%A4%84%E7%90%86%E4%B8%8E%E6%8E%A8%E7%90%86%E9%98%B6%E6%AE%B5"><span class="toc-number">2.4.5.</span> <span class="toc-text">1.4.5大语言模型处理与推理阶段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%E5%B8%B8%E8%A7%81%E4%BA%BA%E5%B7%A5%E9%AA%8C%E8%AF%81%E6%96%B9%E5%BC%8F"><span class="toc-number">2.5.</span> <span class="toc-text">1.5 常见人工验证方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-1-%E7%AE%80%E5%8D%95%E7%82%B9%E5%87%BB%E9%AA%8C%E8%AF%81"><span class="toc-number">2.5.1.</span> <span class="toc-text">1.5.1 简单点击验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-2-%E6%8B%96%E5%8A%A8%E6%BB%91%E5%9D%97%E9%AA%8C%E8%AF%81"><span class="toc-number">2.5.2.</span> <span class="toc-text">1.5.2 拖动滑块验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%A4%E4%B8%AA%E6%80%9D%E8%B7%AF%EF%BC%9AOpenCV%EF%BC%8CVLM"><span class="toc-number">2.5.2.1.</span> <span class="toc-text">两个思路：OpenCV，VLM</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-3-%E7%82%B9%E9%80%89%E6%96%87%E5%AD%97%E9%AA%8C%E8%AF%81"><span class="toc-number">2.5.3.</span> <span class="toc-text">1.5.3 点选文字验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95%E7%94%A8%E4%B8%89%E7%A7%8D%E6%96%B9%E6%A1%88%E6%9D%A5%E5%AE%9E%E7%8E%B0%EF%BC%9AOCR%E3%80%81VLM%E3%80%81YOLO-Siamese%E5%AD%AA%E7%94%9F%E7%BD%91%E7%BB%9C"><span class="toc-number">2.5.3.1.</span> <span class="toc-text">尝试用三种方案来实现：OCR、VLM、YOLO+Siamese孪生网络</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-4-%E8%BA%B2%E9%81%BF%E9%9A%9C%E7%A2%8D"><span class="toc-number">2.5.4.</span> <span class="toc-text">1.5.4 躲避障碍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88%EF%BC%9A%E5%B0%86%E5%9B%BE%E7%89%87%E8%BD%AC%E7%81%B0%E5%BA%A6-VLM-%E8%B7%AF%E5%BE%84%E8%AE%BE%E8%AE%A1%E7%AE%97%E6%B3%95"><span class="toc-number">2.5.4.1.</span> <span class="toc-text">实现方案：将图片转灰度+VLM+路径设计算法</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/12/25/Qwen3-vl-embedding%E6%B5%8B%E8%AF%84%E6%8A%A5%E5%91%8A/" title="Qwen3-vl-embedding测评报告"><img src="/img/%E6%96%87%E7%AB%A0%E9%BB%98%E8%AE%A4%E5%B0%81%E9%9D%A2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Qwen3-vl-embedding测评报告"/></a><div class="content"><a class="title" href="/2025/12/25/Qwen3-vl-embedding%E6%B5%8B%E8%AF%84%E6%8A%A5%E5%91%8A/" title="Qwen3-vl-embedding测评报告">Qwen3-vl-embedding测评报告</a><time datetime="2025-12-25T09:22:52.000Z" title="发表于 2025-12-25 17:22:52">2025-12-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/18/MOE%EF%BC%8C%E9%87%8F%E5%8C%96%EF%BC%8C%E8%92%B8%E9%A6%8F%EF%BC%8C%E5%89%AA%E6%9E%9D/" title="MOE，量化，蒸馏，剪枝"><img src="/img/%E6%96%87%E7%AB%A0%E9%BB%98%E8%AE%A4%E5%B0%81%E9%9D%A2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MOE，量化，蒸馏，剪枝"/></a><div class="content"><a class="title" href="/2025/12/18/MOE%EF%BC%8C%E9%87%8F%E5%8C%96%EF%BC%8C%E8%92%B8%E9%A6%8F%EF%BC%8C%E5%89%AA%E6%9E%9D/" title="MOE，量化，蒸馏，剪枝">MOE，量化，蒸馏，剪枝</a><time datetime="2025-12-18T01:12:12.000Z" title="发表于 2025-12-18 09:12:12">2025-12-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/14/memory%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E8%B0%83%E7%A0%94/" title="memory开源项目调研"><img src="/img/%E6%96%87%E7%AB%A0%E9%BB%98%E8%AE%A4%E5%B0%81%E9%9D%A2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="memory开源项目调研"/></a><div class="content"><a class="title" href="/2025/12/14/memory%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E8%B0%83%E7%A0%94/" title="memory开源项目调研">memory开源项目调研</a><time datetime="2025-12-14T11:12:02.000Z" title="发表于 2025-12-14 19:12:02">2025-12-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/05/HunyuanOCR%E8%B0%83%E7%A0%94%E6%8A%A5%E5%91%8A/" title="HunyuanOCR调研报告"><img src="/img/%E6%96%87%E7%AB%A0%E9%BB%98%E8%AE%A4%E5%B0%81%E9%9D%A2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HunyuanOCR调研报告"/></a><div class="content"><a class="title" href="/2025/12/05/HunyuanOCR%E8%B0%83%E7%A0%94%E6%8A%A5%E5%91%8A/" title="HunyuanOCR调研报告">HunyuanOCR调研报告</a><time datetime="2025-12-05T04:02:44.000Z" title="发表于 2025-12-05 12:02:44">2025-12-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/20/embedding%E5%BE%AE%E8%B0%83%E6%B5%8B%E8%AF%95/" title="embedding微调测试"><img src="/img/%E6%96%87%E7%AB%A0%E9%BB%98%E8%AE%A4%E5%B0%81%E9%9D%A2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="embedding微调测试"/></a><div class="content"><a class="title" href="/2025/11/20/embedding%E5%BE%AE%E8%B0%83%E6%B5%8B%E8%AF%95/" title="embedding微调测试">embedding微调测试</a><time datetime="2025-11-20T03:09:12.000Z" title="发表于 2025-11-20 11:09:12">2025-11-20</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By kukudelin</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div><div class="footer_custom_text">平静的大海培养不出优秀的水手</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div></div></body></html>